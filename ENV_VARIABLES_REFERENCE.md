# Environment Variables Quick Reference

## üö® CRITICAL: These MUST Be Set Before Login Will Work

---

## üì± Vercel (Frontend) - www.mizan.work

### Dashboard Access
https://vercel.com/dashboard ‚Üí Select Project ‚Üí Settings ‚Üí Environment Variables

### Required Variables

```bash
NEXT_PUBLIC_API_URL=https://mizan-backend-production.up.railway.app
```

**Important:**
- Variable name MUST start with `NEXT_PUBLIC_`
- No trailing slash on URL
- Apply to: Production, Preview, Development (all three)
- **Redeploy frontend after adding**

---

## üöÇ Railway (Backend) - mizan-backend-production

### Dashboard Access
https://railway.app/dashboard ‚Üí Select Project ‚Üí Variables

### Required Variables

```bash
# Frontend URLs
CLIENT_URL=https://www.mizan.work
FRONTEND_URL=https://www.mizan.work

# Security (Generate if not set)
JWT_SECRET=<64-char-hex-string>
SESSION_SECRET=<64-char-hex-string>

# Environment
NODE_ENV=production
PORT=3001

# Database (Auto-generated by Railway)
DATABASE_URL=postgresql://...
```

### Generate Secrets

Run locally to generate strong secrets:

```bash
# Generate JWT_SECRET
node -e "console.log('JWT_SECRET=' + require('crypto').randomBytes(64).toString('hex'))"

# Generate SESSION_SECRET
node -e "console.log('SESSION_SECRET=' + require('crypto').randomBytes(64).toString('hex'))"
```

Copy output and paste into Railway variables.

---

## ‚úÖ Quick Verification

### 1. Backend Health Check
```bash
curl https://mizan-backend-production.up.railway.app/health
```
**Expected:** `{"status":"healthy",...}`

### 2. CORS Test
```bash
curl -i -X OPTIONS https://mizan-backend-production.up.railway.app/api/auth/login \
  -H "Origin: https://www.mizan.work" \
  -H "Access-Control-Request-Method: POST"
```
**Expected:** Headers include `Access-Control-Allow-Origin: https://www.mizan.work`

### 3. Frontend Environment Check
Open browser console at https://www.mizan.work:
```javascript
console.log('API URL:', process.env.NEXT_PUBLIC_API_URL);
```
**Expected:** Shows Railway backend URL, not localhost

### 4. Login Test
1. Go to https://www.mizan.work/login
2. Login with: anna@mizan.com / MizanAdmin2024!
3. Should redirect to /dashboard/superadmin
4. Console should show no CORS errors

---

## üêõ Troubleshooting

### Issue: Still showing localhost in production

**Solution:**
1. Verify `NEXT_PUBLIC_API_URL` is set in Vercel
2. Redeploy frontend from Vercel dashboard
3. Hard refresh browser (Ctrl+Shift+R)
4. Clear localStorage: `localStorage.clear()`

### Issue: CORS errors persist

**Solution:**
1. Verify `CLIENT_URL=https://www.mizan.work` in Railway
2. Check Railway logs for CORS preflight logs
3. Verify backend is deployed and running
4. Test health endpoint directly

### Issue: 401 Unauthorized

**Solution:**
1. Verify `JWT_SECRET` and `SESSION_SECRET` are set in Railway
2. Clear browser localStorage and login again
3. Verify superadmin user exists in database
4. Check Railway logs for authentication errors

---

## üìã Deployment Checklist

Before testing login:

- [ ] Set `NEXT_PUBLIC_API_URL` in Vercel
- [ ] Redeploy Vercel frontend
- [ ] Verify `CLIENT_URL` in Railway
- [ ] Verify `JWT_SECRET` in Railway
- [ ] Verify `SESSION_SECRET` in Railway
- [ ] Backend health check passes
- [ ] CORS preflight test passes
- [ ] Clear browser cache and localStorage
- [ ] Test login with superadmin credentials

---

## üîó Useful Links

- **Vercel Dashboard:** https://vercel.com/dashboard
- **Railway Dashboard:** https://railway.app/dashboard
- **Frontend URL:** https://www.mizan.work
- **Backend Health:** https://mizan-backend-production.up.railway.app/health
- **Login Page:** https://www.mizan.work/login

---

## üìû Quick Support Commands

### Clear Browser Cache
```javascript
// In browser console
localStorage.clear();
sessionStorage.clear();
// Then: Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)
```

### Check Railway Logs
```bash
# If you have Railway CLI
railway logs

# Or check in dashboard:
# Railway ‚Üí Project ‚Üí Logs tab
```

### Create Superadmin User
```bash
curl -X POST https://mizan-backend-production.up.railway.app/api/create-superadmin-temp
```

---

**Remember:** Changes to environment variables require redeployment!

- Vercel: Redeploy from Deployments tab
- Railway: Auto-deploys when variables are saved

---

**Last Updated:** January 16, 2025
**Status:** Production Configuration

