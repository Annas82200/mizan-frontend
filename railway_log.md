2025-10-22T15:52:27.000000000Z [inf]  Starting Container
2025-10-22T15:52:28.699434477Z [inf]  ========================================
2025-10-22T15:52:28.699439489Z [inf]  ========================================
2025-10-22T15:52:28.699442766Z [inf]  ⚙️  Environment variables ready (injected by platform)
2025-10-22T15:52:28.699444685Z [inf]    - DATABASE_URL: ✅ SET
2025-10-22T15:52:28.699450628Z [inf]  📊 Environment Check:
2025-10-22T15:52:28.699453508Z [inf]  🚀 Mizan Server Process Starting...
2025-10-22T15:52:28.699457367Z [inf]    - SESSION_SECRET: ⚠️  NOT SET
2025-10-22T15:52:28.699464380Z [inf]    - PORT: 8080
2025-10-22T15:52:28.699464420Z [inf]  📅 Timestamp: 2025-10-22T15:52:27.829Z
2025-10-22T15:52:28.699468739Z [inf]  📚 Loading database module...
2025-10-22T15:52:28.699469360Z [inf]  🌍 Node Version: v20.19.5
2025-10-22T15:52:28.699472450Z [inf]    - JWT_SECRET: ✅ SET
2025-10-22T15:52:28.699475780Z [inf]  ✅ Database module loaded
2025-10-22T15:52:28.699481311Z [inf]  💡 Configured Port: 8080
2025-10-22T15:52:28.699482583Z [inf]  📦 Environment: production
2025-10-22T15:52:28.699489510Z [inf]    'http://localhost:3000',
2025-10-22T15:52:28.699492054Z [inf]  💡 Configured Host: 0.0.0.0
2025-10-22T15:52:28.699492429Z [inf]  🔄 Deployment Version: 3d76766
2025-10-22T15:52:28.699500449Z [inf]    'http://localhost:3001',
2025-10-22T15:52:28.699506261Z [inf]    'https://mizan-frontend-ten.vercel.app',
2025-10-22T15:52:28.699507172Z [inf]  🌐 CORS configured with dynamic origin checking
2025-10-22T15:52:28.699507240Z [inf]    'https://api.mizan.work',
2025-10-22T15:52:28.699510587Z [inf]    'https://mizan.work',
2025-10-22T15:52:28.699518101Z [inf]    'https://mizan-api.railway.app'
2025-10-22T15:52:28.699520784Z [inf]    'https://www.mizan.work',
2025-10-22T15:52:28.699523295Z [inf]  ✅ Allowed origins (static): [
2025-10-22T15:52:28.699523633Z [inf]    'https://mizan-platform-final.vercel.app',
2025-10-22T15:52:28.704373432Z [inf]  ]
2025-10-22T15:52:28.704384863Z [inf]  ✅ Dynamic patterns: *.vercel.app, *.railway.app
2025-10-22T15:52:28.704392004Z [inf]  🔧 CLIENT_URL environment variable: https://mizan.work
2025-10-22T15:52:28.704399115Z [inf]  🔧 FRONTEND_URL environment variable: https://mizan.work
2025-10-22T15:52:28.704405132Z [inf]  🎬 Invoking startServer() function...
2025-10-22T15:52:28.704413996Z [inf]  
2025-10-22T15:52:28.704420035Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-22T15:52:28.704425562Z [inf]  🚀 STARTING MIZAN PLATFORM SERVER v2.0.0
2025-10-22T15:52:28.704431553Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-22T15:52:28.704437948Z [inf]  📍 Environment: production
2025-10-22T15:52:28.704445281Z [inf]  🔌 Port: 8080
2025-10-22T15:52:28.704451432Z [inf]  🖥️  Host: 0.0.0.0
2025-10-22T15:52:28.704458153Z [inf]  
2025-10-22T15:52:28.704466626Z [inf]  🔐 Security Configuration:
2025-10-22T15:52:28.704472822Z [inf]    ✅ DATABASE_URL is configured
2025-10-22T15:52:28.704479340Z [inf]    ✅ JWT/SESSION_SECRET is configured
2025-10-22T15:52:28.704485280Z [inf]  
2025-10-22T15:52:28.704493265Z [inf]  🌐 Starting HTTP server...
2025-10-22T15:52:28.704499453Z [inf]     Binding to: 0.0.0.0:8080
2025-10-22T15:52:28.704505374Z [inf]  🔍 Database connection attempt 1/2...
2025-10-22T15:52:28.704511146Z [inf]  🔍 Testing database connection...
2025-10-22T15:52:28.704517102Z [inf]  
2025-10-22T15:52:28.704523452Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-22T15:52:28.709508747Z [inf]  ✅ MIZAN PLATFORM SERVER ONLINE
2025-10-22T15:52:28.709524760Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-22T15:52:28.709533951Z [inf]  🌐 Server: http://0.0.0.0:8080
2025-10-22T15:52:28.709542206Z [inf]  🏥 Health: http://0.0.0.0:8080/health
2025-10-22T15:52:28.709550253Z [inf]  📊 Features: Three-Engine AI, Multi-Provider Consensus
2025-10-22T15:52:28.709558108Z [inf]  🔒 Security: CORS, Helmet, Rate Limiting
2025-10-22T15:52:28.709565399Z [inf]  🗄️  Database: Testing connection in background...
2025-10-22T15:52:28.709572250Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-22T15:52:28.709579692Z [inf]  
2025-10-22T15:52:28.709587414Z [inf]  ✅ startServer() invocation completed successfully
2025-10-22T15:52:28.709596441Z [inf]  ✅ Database connection established
2025-10-22T15:52:28.709603551Z [inf]  ✅ Database connection established
2025-10-22T15:52:28.709610897Z [inf]  ✅ Database connection successful
2025-10-22T15:52:28.709618193Z [inf]  ✅ Database fully connected and operational
2025-10-22T15:52:28.709624728Z [inf]  ✅ Database connection validated successfully
2025-10-22T15:52:29.895080108Z [inf]  🏥 Health check requested. Reporting current status:
2025-10-22T15:52:29.895085242Z [inf]    - Server Status: running
2025-10-22T15:52:29.895090700Z [inf]    - Database Status: connected
2025-10-22T15:52:29.895096277Z [inf]    - DATABASE_URL: Set (hidden)
2025-10-22T15:52:59.902919424Z [inf]  📤 Database connection removed from pool
2025-10-22T15:52:59.902926441Z [inf]  📤 Database connection removed from pool
2025-10-22T15:55:57.609943645Z [inf]  📥 [Request] {
2025-10-22T15:55:57.609944684Z [inf]  Fetching tenants for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-22T15:55:57.609954773Z [inf]  Database connection verified for tenants
2025-10-22T15:55:57.609961274Z [inf]  ✅ Database connection established
2025-10-22T15:55:57.609963047Z [inf]  Fetched tenants: 3
2025-10-22T15:55:57.609969442Z [inf]  ✅ Converted tenant ID: "99c97d43-d075-4ebe-b719-24511cd287d6" -> 580118854 (type: number)
2025-10-22T15:55:57.609970243Z [inf]  ✅ Converted tenant ID: "superadmin-tenant" -> 1 (type: number)
2025-10-22T15:55:57.609977369Z [inf]  ✅ Database connection established
2025-10-22T15:55:57.609987140Z [inf]  ✅ Converted tenant ID: "1ce32fe3-6788-44e9-82c5-fb799a0501ab" -> 484650980 (type: number)
2025-10-22T15:55:57.609996874Z [inf]    method: 'GET',
2025-10-22T15:55:57.610007462Z [inf]    hasAuth: true,
2025-10-22T15:55:57.610022072Z [inf]    contentType: 'application/json'
2025-10-22T15:55:57.610029911Z [inf]  }
2025-10-22T15:55:57.610031008Z [inf]    path: '/api/superadmin/tenants',
2025-10-22T15:55:57.610044168Z [inf]  ✅ Database connection established
2025-10-22T15:55:57.610049679Z [inf]    origin: 'https://www.mizan.work',
2025-10-22T15:55:59.836406298Z [inf]  📥 [Request] {
2025-10-22T15:55:59.836412434Z [inf]    method: 'POST',
2025-10-22T15:55:59.836421018Z [inf]    path: '/api/upload/org-chart',
2025-10-22T15:55:59.836426439Z [inf]    origin: 'https://www.mizan.work',
2025-10-22T15:55:59.836431683Z [inf]    hasAuth: true,
2025-10-22T15:55:59.836437431Z [inf]    contentType: 'multipart/form-data; boundary=----WebKitFormBoundarylqGRU5ZzHHzAqx8a'
2025-10-22T15:55:59.836441922Z [inf]  }
2025-10-22T15:55:59.836445965Z [inf]  ✅ Organization structure saved successfully
2025-10-22T15:55:59.836450203Z [inf]  📊 Data quality: 12 employees, 3 levels, 5 departments
2025-10-22T15:56:29.856962183Z [inf]  📤 Database connection removed from pool
2025-10-22T15:56:29.856969785Z [inf]  📤 Database connection removed from pool
2025-10-22T15:56:29.856976543Z [inf]  📤 Database connection removed from pool
2025-10-22T15:56:38.723058905Z [inf]  ✅ Database connection established
2025-10-22T15:56:38.723064069Z [inf]  📊 Fetching organization structure for tenant: 484650980
2025-10-22T15:56:38.723068741Z [inf]  ✅ Database connection established
2025-10-22T15:56:38.723073987Z [inf]  ✅ Organization structure found for tenant: 484650980
2025-10-22T15:56:38.723078376Z [inf]  📊 Data Quality Check: {
2025-10-22T15:56:38.723082742Z [inf]    hasDepartments: true,
2025-10-22T15:56:38.723087390Z [inf]    departmentCount: 5,
2025-10-22T15:56:38.723092312Z [inf]    hasReportingLines: true,
2025-10-22T15:56:38.723097221Z [inf]    reportingLineCount: 11,
2025-10-22T15:56:38.723102039Z [inf]    hasRoles: true,
2025-10-22T15:56:38.723106479Z [inf]    roleCount: 12,
2025-10-22T15:56:38.723111466Z [inf]    totalEmployees: 12,
2025-10-22T15:56:38.723116648Z [inf]    organizationLevels: 3
2025-10-22T15:56:38.723123609Z [inf]  }
2025-10-22T15:57:18.196827323Z [inf]  📤 Database connection removed from pool
2025-10-22T15:57:20.971211608Z [err]  Provider anthropic confidence too low: 0.5999999999999999
2025-10-22T15:57:50.315114829Z [err]  Provider mistral confidence too low: 0.5999999999999999
2025-10-22T15:59:01.446155594Z [err]  Provider anthropic confidence too low: 0.5999999999999999
2025-10-22T15:59:52.129088213Z [err]  Request failed: The operation was aborted due to timeout
2025-10-22T15:59:52.129094564Z [err]  Request failed: The operation was aborted due to timeout
2025-10-22T15:59:52.129107585Z [err]  Request failed: The operation was aborted due to timeout
2025-10-22T15:59:52.985301782Z [err]  Request failed: The operation was aborted due to timeout
2025-10-22T16:00:01.798298349Z [err]  Request failed: The operation was aborted due to timeout
2025-10-22T16:00:01.798304939Z [err]  Mistral invocation failed: DOMException [TimeoutError]: The operation was aborted due to timeout
2025-10-22T16:00:01.798313240Z [err]      at node:internal/deps/undici/undici:13510:13
2025-10-22T16:00:01.798320678Z [err]  Provider mistral failed: DOMException [TimeoutError]: The operation was aborted due to timeout
2025-10-22T16:00:01.798327623Z [err]      at node:internal/deps/undici/undici:13510:13
2025-10-22T16:00:01.798334460Z [inf]  ✅ Structure analysis completed successfully
2025-10-22T16:00:01.798341806Z [inf]  ✅ Database connection established
2025-10-22T16:00:01.798347954Z [inf]  📊 Sending response to frontend: {
2025-10-22T16:00:01.798353676Z [inf]    id: '3fa0d453-9da1-4b38-b6ed-956ab755e9cf',
2025-10-22T16:00:01.798359999Z [inf]    success: true,
2025-10-22T16:00:01.798365989Z [inf]    dataSaved: true,
2025-10-22T16:00:01.798372158Z [inf]    analysisCompleted: true,
2025-10-22T16:00:01.798377893Z [inf]    employeesCreated: 0,
2025-10-22T16:00:01.798384400Z [inf]    hasAnalysisResult: true,
2025-10-22T16:00:01.798390816Z [inf]    analysisResultKeys: [
2025-10-22T16:00:01.798397327Z [inf]      'overall_score',
2025-10-22T16:00:01.798403238Z [inf]      'span_analysis',
2025-10-22T16:00:01.798408974Z [inf]      'layer_analysis',
2025-10-22T16:00:01.798414555Z [inf]      'strategy_alignment',
2025-10-22T16:00:01.798421086Z [inf]      'recommendations'
2025-10-22T16:00:01.798427446Z [inf]    ]
2025-10-22T16:00:01.798435001Z [inf]  }
2025-10-22T16:00:01.798442133Z [inf]  📥 [Request] {
2025-10-22T16:00:01.798448213Z [inf]    method: 'POST',
2025-10-22T16:00:01.798454502Z [inf]    path: '/api/analyses/structure',
2025-10-22T16:00:01.798461041Z [inf]    origin: 'https://www.mizan.work',
2025-10-22T16:00:01.798467247Z [inf]    hasAuth: true,
2025-10-22T16:00:02.899972969Z [inf]    contentType: 'application/json'
2025-10-22T16:00:02.899978993Z [inf]  }
2025-10-22T16:00:33.147685734Z [inf]  📤 Database connection removed from pool