2025-10-23T02:33:39.000000000Z [inf]  Starting Container
2025-10-23T02:33:40.126780427Z [inf]  ========================================
2025-10-23T02:33:40.126785899Z [inf]  🚀 Mizan Server Process Starting...
2025-10-23T02:33:40.126792728Z [inf]  📅 Timestamp: 2025-10-23T02:33:39.445Z
2025-10-23T02:33:40.126798747Z [inf]  🌍 Node Version: v20.19.5
2025-10-23T02:33:40.126804644Z [inf]  📦 Environment: production
2025-10-23T02:33:40.126809798Z [inf]  🔄 Deployment Version: 784ef18
2025-10-23T02:33:40.126815125Z [inf]  ========================================
2025-10-23T02:33:40.126820796Z [inf]  ⚙️  Environment variables ready (injected by platform)
2025-10-23T02:33:40.126827879Z [inf]  📚 Loading database module...
2025-10-23T02:33:40.126834737Z [inf]  ✅ Configuration validated successfully
2025-10-23T02:33:40.126839639Z [inf]  📍 Environment: production
2025-10-23T02:33:40.126845346Z [inf]  🔌 Port: 8080
2025-10-23T02:33:40.126850444Z [inf]  🗄️  Database: Connected
2025-10-23T02:33:40.126856265Z [inf]  🤖 AI Providers: OpenAI, Anthropic, Google, Mistral
2025-10-23T02:33:40.126862613Z [inf]  
2025-10-23T02:33:40.126947287Z [inf]  ✅ Database module loaded
2025-10-23T02:33:40.126953631Z [inf]  💡 Configured Port: 8080
2025-10-23T02:33:40.126960737Z [inf]  💡 Configured Host: 0.0.0.0
2025-10-23T02:33:40.126966232Z [inf]  🌐 CORS configured with dynamic origin checking
2025-10-23T02:33:40.126972373Z [inf]  ✅ Allowed origins (static): [
2025-10-23T02:33:40.126977395Z [inf]    'http://localhost:3000',
2025-10-23T02:33:40.126982249Z [inf]    'http://localhost:3001',
2025-10-23T02:33:40.126987653Z [inf]    'https://mizan.work',
2025-10-23T02:33:40.126992746Z [inf]    'https://www.mizan.work',
2025-10-23T02:33:40.127002848Z [inf]    'https://api.mizan.work',
2025-10-23T02:33:40.127008583Z [inf]    'https://mizan-platform-final.vercel.app',
2025-10-23T02:33:40.127014052Z [inf]    'https://mizan-frontend-ten.vercel.app',
2025-10-23T02:33:40.127428887Z [inf]    'https://mizan-api.railway.app'
2025-10-23T02:33:40.127433886Z [inf]  📍 Environment: production
2025-10-23T02:33:40.127436269Z [inf]  
2025-10-23T02:33:40.127436677Z [inf]  🔧 FRONTEND_URL environment variable: https://mizan.work
2025-10-23T02:33:40.127445352Z [inf]  ]
2025-10-23T02:33:40.127447133Z [inf]  🔌 Port: 8080
2025-10-23T02:33:40.127448938Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T02:33:40.127457073Z [inf]  🖥️  Host: 0.0.0.0
2025-10-23T02:33:40.127462361Z [inf]  🎬 Invoking startServer() function...
2025-10-23T02:33:40.127463662Z [inf]    ✅ DATABASE_URL is configured
2025-10-23T02:33:40.127465316Z [inf]  ✅ Dynamic patterns: *.vercel.app, *.railway.app
2025-10-23T02:33:40.127473773Z [inf]  
2025-10-23T02:33:40.127476225Z [inf]  
2025-10-23T02:33:40.127477844Z [inf]  🔧 CLIENT_URL environment variable: https://mizan.work
2025-10-23T02:33:40.127480243Z [inf]    ✅ JWT/SESSION_SECRET is configured
2025-10-23T02:33:40.127489231Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T02:33:40.127492631Z [inf]  🔐 Security Configuration:
2025-10-23T02:33:40.127492752Z [inf]  
2025-10-23T02:33:40.127501665Z [inf]  🚀 STARTING MIZAN PLATFORM SERVER v2.0.0
2025-10-23T02:33:40.127505587Z [inf]  🌐 Starting HTTP server...
2025-10-23T02:33:40.127511608Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T02:33:40.127513696Z [inf]     Binding to: 0.0.0.0:8080
2025-10-23T02:33:40.127521701Z [inf]  🔍 Database connection attempt 1/2...
2025-10-23T02:33:40.127528558Z [inf]  🔍 Testing database connection...
2025-10-23T02:33:40.128645480Z [inf]  ✅ Database fully connected and operational
2025-10-23T02:33:40.128656977Z [inf]  ✅ MIZAN PLATFORM SERVER ONLINE
2025-10-23T02:33:40.128658646Z [inf]  ✅ Database connection established
2025-10-23T02:33:40.128659032Z [inf]  ✅ startServer() invocation completed successfully
2025-10-23T02:33:40.128674216Z [inf]  ✅ Database connection established
2025-10-23T02:33:40.128675707Z [inf]  ✅ Database connection successful
2025-10-23T02:33:40.128675741Z [inf]    - Database Status: disconnected
2025-10-23T02:33:40.128676609Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T02:33:40.128688998Z [inf]  ✅ Database connection validated successfully
2025-10-23T02:33:40.128691514Z [inf]  🌐 Server: http://0.0.0.0:8080
2025-10-23T02:33:40.128693884Z [inf]    - DATABASE_URL: Set (hidden)
2025-10-23T02:33:40.128701560Z [inf]  🏥 Health check requested. Reporting current status:
2025-10-23T02:33:40.128706240Z [inf]  🏥 Health: http://0.0.0.0:8080/health
2025-10-23T02:33:40.128712063Z [inf]    - Server Status: running
2025-10-23T02:33:40.128717979Z [inf]  📊 Features: Three-Engine AI, Multi-Provider Consensus
2025-10-23T02:33:40.128726590Z [inf]  🔒 Security: CORS, Helmet, Rate Limiting
2025-10-23T02:33:40.128734982Z [inf]  🗄️  Database: Testing connection in background...
2025-10-23T02:33:40.128747832Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T02:33:40.128756277Z [inf]  
2025-10-23T02:34:09.935356635Z [inf]  📥 [Request] {
2025-10-23T02:34:09.935362375Z [inf]    method: 'GET',
2025-10-23T02:34:09.935367683Z [inf]    path: '/api/superadmin/tenants',
2025-10-23T02:34:09.935372744Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T02:34:09.935379327Z [inf]    hasAuth: true,
2025-10-23T02:34:09.935384583Z [inf]    contentType: 'application/json'
2025-10-23T02:34:09.935389582Z [inf]  }
2025-10-23T02:34:09.935394335Z [inf]  Fetching tenants for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T02:34:09.935400522Z [inf]  Database connection verified for tenants
2025-10-23T02:34:09.935405866Z [inf]  Fetched tenants: 3
2025-10-23T02:34:09.935411057Z [inf]  ✅ Converted tenant ID: "superadmin-tenant" -> 1 (type: number)
2025-10-23T02:34:09.935416885Z [inf]  ✅ Converted tenant ID: "99c97d43-d075-4ebe-b719-24511cd287d6" -> 580118854 (type: number)
2025-10-23T02:34:09.935421639Z [inf]  ✅ Database connection established
2025-10-23T02:34:09.935426466Z [inf]  ✅ Converted tenant ID: "1ce32fe3-6788-44e9-82c5-fb799a0501ab" -> 484650980 (type: number)
2025-10-23T02:34:39.939805625Z [inf]  📤 Database connection removed from pool
2025-10-23T02:34:39.939813686Z [inf]  📤 Database connection removed from pool
2025-10-23T02:34:39.939819597Z [inf]  📤 Database connection removed from pool
2025-10-23T02:35:09.554351027Z [inf]  📥 [Request] {
2025-10-23T02:35:09.554364932Z [inf]    method: 'GET',
2025-10-23T02:35:09.554370680Z [inf]    path: '/api/superadmin/tenants',
2025-10-23T02:35:09.554375206Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T02:35:09.554379581Z [inf]    hasAuth: true,
2025-10-23T02:35:09.554384239Z [inf]    contentType: 'application/json'
2025-10-23T02:35:09.554388943Z [inf]  }
2025-10-23T02:35:09.554394519Z [inf]  ✅ Database connection established
2025-10-23T02:35:09.554399787Z [inf]  Fetching tenants for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T02:35:09.554407403Z [inf]  Database connection verified for tenants
2025-10-23T02:35:09.554411536Z [inf]  Fetched tenants: 3
2025-10-23T02:35:09.554415721Z [inf]  ✅ Converted tenant ID: "superadmin-tenant" -> 1 (type: number)
2025-10-23T02:35:09.554419978Z [inf]  ✅ Database connection established
2025-10-23T02:35:09.554424267Z [inf]  ✅ Converted tenant ID: "1ce32fe3-6788-44e9-82c5-fb799a0501ab" -> 484650980 (type: number)
2025-10-23T02:35:09.554429815Z [inf]  ✅ Database connection established
2025-10-23T02:35:09.554434276Z [inf]  ✅ Converted tenant ID: "99c97d43-d075-4ebe-b719-24511cd287d6" -> 580118854 (type: number)
2025-10-23T02:35:09.554438426Z [inf]  📥 [Request] {
2025-10-23T02:35:09.554444610Z [inf]    method: 'GET',
2025-10-23T02:35:09.554450733Z [inf]    path: '/api/admin/employees',
2025-10-23T02:35:09.554454763Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T02:35:09.554458792Z [inf]    hasAuth: true,
2025-10-23T02:35:09.554473027Z [inf]    contentType: 'application/json'
2025-10-23T02:35:09.554477722Z [inf]  }
2025-10-23T02:35:29.553879106Z [inf]  📥 [Request] {
2025-10-23T02:35:29.553885885Z [inf]    method: 'GET',
2025-10-23T02:35:29.553890807Z [inf]    path: '/api/superadmin/tenants',
2025-10-23T02:35:29.553895155Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T02:35:29.553905164Z [inf]    hasAuth: true,
2025-10-23T02:35:29.553909371Z [inf]    contentType: 'application/json'
2025-10-23T02:35:29.553914433Z [inf]  }
2025-10-23T02:35:29.553919460Z [inf]  Fetching tenants for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T02:35:29.553924563Z [inf]  Database connection verified for tenants
2025-10-23T02:35:29.553930924Z [inf]  Fetched tenants: 3
2025-10-23T02:35:29.553936075Z [inf]  ✅ Converted tenant ID: "99c97d43-d075-4ebe-b719-24511cd287d6" -> 580118854 (type: number)
2025-10-23T02:35:29.553941270Z [inf]  ✅ Converted tenant ID: "superadmin-tenant" -> 1 (type: number)
2025-10-23T02:35:29.553946595Z [inf]  ✅ Converted tenant ID: "1ce32fe3-6788-44e9-82c5-fb799a0501ab" -> 484650980 (type: number)
2025-10-23T02:35:36.284890668Z [inf]    method: 'POST',
2025-10-23T02:35:36.284900069Z [inf]    path: '/api/upload/org-chart',
2025-10-23T02:35:36.284905412Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T02:35:36.284910393Z [inf]    hasAuth: true,
2025-10-23T02:35:36.284915930Z [inf]    contentType: 'multipart/form-data; boundary=----WebKitFormBoundaryFbmbhebBxYkLNkmv'
2025-10-23T02:35:36.284922222Z [inf]  }
2025-10-23T02:35:36.284930286Z [inf]  ✅ Organization structure saved successfully
2025-10-23T02:35:36.284935540Z [inf]  📊 Data quality: 12 employees, 3 levels, 5 departments
2025-10-23T02:35:36.285078374Z [inf]  📥 [Request] {
2025-10-23T02:36:06.072929789Z [inf]  📤 Database connection removed from pool
2025-10-23T02:36:06.072934161Z [inf]  📤 Database connection removed from pool
2025-10-23T02:36:06.072939026Z [err]  Provider mistral confidence too low: 0.5999999999999999 {
2025-10-23T02:36:06.072944441Z [err]    threshold: 0.7,
2025-10-23T02:36:06.072950828Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T02:36:06.072955497Z [err]    prompt_length: 5738,
2025-10-23T02:36:06.072960483Z [err]    response_length: 8545,
2025-10-23T02:36:06.072965386Z [err]    timestamp: '2025-10-23T02:35:57.563Z',
2025-10-23T02:36:06.072969624Z [err]    engine: 'knowledge'
2025-10-23T02:36:06.072974403Z [err]  }
2025-10-23T02:36:06.224853472Z [inf]  📤 Database connection removed from pool
2025-10-23T02:36:15.682246067Z [inf]  ✅ Database connection established
2025-10-23T02:36:15.682251995Z [inf]  📊 Fetching organization structure for tenant: 484650980
2025-10-23T02:36:15.749383710Z [inf]  ✅ Database connection established
2025-10-23T02:36:15.761420514Z [inf]  ✅ Organization structure found for tenant: 484650980
2025-10-23T02:36:15.761429690Z [inf]  📊 Data Quality Check: {
2025-10-23T02:36:15.761435884Z [inf]    hasDepartments: true,
2025-10-23T02:36:15.761441792Z [inf]    departmentCount: 5,
2025-10-23T02:36:15.761448209Z [inf]    hasReportingLines: true,
2025-10-23T02:36:15.761453183Z [inf]    reportingLineCount: 11,
2025-10-23T02:36:15.761459632Z [inf]    hasRoles: true,
2025-10-23T02:36:15.761465443Z [inf]    roleCount: 12,
2025-10-23T02:36:15.761470775Z [inf]    totalEmployees: 12,
2025-10-23T02:36:15.761477489Z [inf]    organizationLevels: 3
2025-10-23T02:36:15.761483129Z [inf]  }
2025-10-23T02:36:35.460670066Z [err]  }
2025-10-23T02:36:35.460682028Z [err]  Provider openai confidence too low: 0.5999999999999999 {
2025-10-23T02:36:35.460687897Z [err]    threshold: 0.7,
2025-10-23T02:36:35.460693227Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T02:36:35.460698523Z [err]    prompt_length: 4185,
2025-10-23T02:36:35.460704385Z [err]    response_length: 3561,
2025-10-23T02:36:35.460709685Z [err]    timestamp: '2025-10-23T02:36:30.356Z',
2025-10-23T02:36:35.460716491Z [err]    engine: 'data'
2025-10-23T02:36:44.164372320Z [err]    threshold: 0.7,
2025-10-23T02:36:44.164398483Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T02:36:44.164405339Z [err]    prompt_length: 4185,
2025-10-23T02:36:44.164412271Z [err]    response_length: 13423,
2025-10-23T02:36:44.164419406Z [err]    timestamp: '2025-10-23T02:36:43.743Z',
2025-10-23T02:36:44.164425570Z [err]    engine: 'data'
2025-10-23T02:36:44.164448698Z [err]  }
2025-10-23T02:36:44.164535377Z [err]  Provider mistral confidence too low: 0.5999999999999999 {
2025-10-23T02:36:46.107260254Z [inf]  📤 Database connection removed from pool
2025-10-23T02:37:05.793402699Z [err]    response_length: 8953,
2025-10-23T02:37:05.793408393Z [err]  ❌ Failed to parse data output after repair: {
2025-10-23T02:37:05.793409750Z [err]      '    "structure_efficiency_score": 0,\n' +
2025-10-23T02:37:05.793414874Z [err]    timestamp: '2025-10-23T02:36:57.305Z',
2025-10-23T02:37:05.793420153Z [err]    error: "Expected ',' or '}' after property value in JSON at position 340",
2025-10-23T02:37:05.793421979Z [err]      '    "communication_path_score": 0\n' +
2025-10-23T02:37:05.793422855Z [err]      '  "structure_metrics": {\n' +
2025-10-23T02:37:05.793429363Z [err]    rawResponsePreview: '```json\n' +
2025-10-23T02:37:05.793431692Z [err]      '  },\n' +
2025-10-23T02:37:05.793433676Z [err]    engine: 'data'
2025-10-23T02:37:05.793437391Z [err]      '    "total_layers": 3,\n' +
2025-10-23T02:37:05.793438537Z [err]      '{\n' +
2025-10-23T02:37:05.793439376Z [err]      '    "max_span_of_control": 0,\n' +
2025-10-23T02:37:05.793445935Z [err]  }
2025-10-23T02:37:05.793447720Z [err]      '    "average_layers_to_bottom": 0.5833333333333334,\n' +
2025-10-23T02:37:05.793451064Z [err]      '    "min_span_of_control": 0,\n' +
2025-10-23T02:37:05.793456109Z [err]  ⚠️  Initial JSON parse failed, attempting repair...
2025-10-23T02:37:05.793457904Z [err]      '    "average_span_of_control": 0,\n' +
2025-10-23T02:37:05.793463592Z [inf]  🔧 Attempting JSON repair for malformed response...
2025-10-23T02:37:05.793465452Z [err]      '    "strategy_alignment_score": 0,\n' +
2025-10-23T02:37:05.793472658Z [err]  Provider anthropic confidence too low: 0.5999999999999999 {
2025-10-23T02:37:05.793473597Z [inf]  ❌ Error at position 340, context: pan":0,"max_span":0,"min_span":0,"distribution":{}
2025-10-23T02:37:05.793480178Z [err]    threshold: 0.7,
2025-10-23T02:37:05.793486353Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T02:37:05.793492190Z [err]    prompt_length: 4185,
2025-10-23T02:37:05.796576765Z [err]      '  "span_analysis": {\n' +
2025-10-23T02:37:05.796584089Z [err]      '    "average_span": 0,\n' +
2025-10-23T02:37:05.796593291Z [err]      '    "max_span": 0,\n' +
2025-10-23T02:37:05.796600282Z [err]      '    "min_span": 0,\n' +
2025-10-23T02:37:05.796609186Z [err]      '    "distribution": {},\n' +
2025-10-23T02:37:05.796615597Z [err]      '    "outliers": [],\n' +
2025-10-23T02:37:05.796622764Z [err]      '    "observations": [\n' +
2025-10-23T02:37:05.796629483Z [err]      '      "All span of control metrics (a',
2025-10-23T02:37:05.796637684Z [err]    cleanedResponsePreview: '{  "structure_metrics":{    "total_layers":3,"average_layers_to_bottom":0.5833333333333334,"average_span_of_control":0,"max_span_of_control":0,"min_span_of_control":0,"strategy_alignment_score":0,"structure_efficiency_score":0,"communication_path_score":0  },"span_analysis":{    "average_span":0,"max_span":0,"min_span":0,"distribution":{}'
2025-10-23T02:37:05.796650180Z [err]  }
2025-10-23T02:37:35.818124366Z [err]      '{\n' +
2025-10-23T02:37:35.818128121Z [err]  ⚠️  Initial JSON parse failed, attempting repair...
2025-10-23T02:37:35.818134601Z [inf]  🔧 Attempting JSON repair for malformed response...
2025-10-23T02:37:35.818134668Z [err]      '  "overall_score": 0,\n' +
2025-10-23T02:37:35.818139292Z [inf]  ❌ Error at position 3169, context: th assessment","details":"Once data is available,"evaluate":span of control by level,layer efficienc
2025-10-23T02:37:35.818144776Z [inf]  ✅ Fixed: Quoted unquoted key: evaluate
2025-10-23T02:37:35.818145686Z [err]      '  "data_quality_issue": true,\n' +
2025-10-23T02:37:35.818152486Z [err]      '  "analysis_status": "INCOMPLETE - Missing critical structural metrics",\n' +
2025-10-23T02:37:35.818153843Z [err]  ❌ Failed to parse reasoning output after repair: {
2025-10-23T02:37:35.818158730Z [err]      '  \n' +
2025-10-23T02:37:35.818159923Z [err]    error: "Expected ',' or '}' after property value in JSON at position 3169",
2025-10-23T02:37:35.818165365Z [err]      '  "span_analysis": {\n' +
2025-10-23T02:37:35.818165477Z [err]    rawResponsePreview: '# Organizational Structure Analysis - Reasoning Engine Output\n' +
2025-10-23T02:37:35.818171810Z [err]      '    "status": "NO_DATA_AVAILABLE",\n' +
2025-10-23T02:37:35.818173123Z [err]      '\n' +
2025-10-23T02:37:35.818177247Z [err]      '    "expected_data": [\n' +
2025-10-23T02:37:35.818179215Z [err]      '## Critical Data Issue Detected\n' +
2025-10-23T02:37:35.818185882Z [err]      '      "Number of direct reports per manager/leader",\n' +
2025-10-23T02:37:35.818186292Z [err]      '\n' +
2025-10-23T02:37:35.818191831Z [err]      '⚠️ **Unable to perform comprehensive analysis due to missing structural data**\n' +
2025-10-23T02:37:35.818195161Z [err]      '      "Role classifications (Executive/Management/Oper',
2025-10-23T02:37:35.818197115Z [err]      '\n' +
2025-10-23T02:37:35.818201196Z [err]      '```json\n' +
2025-10-23T02:37:35.819838669Z [inf]      'overall_score',
2025-10-23T02:37:35.819840160Z [inf]  📥 [Request] {
2025-10-23T02:37:35.819842030Z [err]    cleanedResponsePreview: '{  "overall_score":0,"data_quality_issue":true,"analysis_status":"INCOMPLETE - Missing critical structural metrics","span_analysis":{    "status":"NO_DATA_AVAILABLE","expected_data":[      "Number of direct reports per manager/leader","Role classifications (Executive/Management/Operational)","Manager-to-employee ratios by department"    ],"theoretical_benchmarks":{      "executive_optimal":5,"management_optimal":8,"operational_optimal":12    },"assessment":"Cannot evaluate span of control withou'
2025-10-23T02:37:35.819850384Z [err]  }
2025-10-23T02:37:35.819851166Z [inf]      'span_analysis',
2025-10-23T02:37:35.819854359Z [inf]    method: 'POST',
2025-10-23T02:37:35.819857072Z [inf]  ✅ Structure analysis completed successfully
2025-10-23T02:37:35.819857390Z [inf]      'layer_analysis',
2025-10-23T02:37:35.819863512Z [inf]  ✅ Database connection established
2025-10-23T02:37:35.819863867Z [inf]    path: '/api/analyses/structure',
2025-10-23T02:37:35.819871476Z [inf]  📊 Sending response to frontend: {
2025-10-23T02:37:35.819872757Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T02:37:35.819873161Z [inf]      'strategy_alignment',
2025-10-23T02:37:35.819878436Z [inf]    id: '5dc5dfde-d5ff-418e-853b-07afe2747fae',
2025-10-23T02:37:35.819879937Z [inf]      'recommendations'
2025-10-23T02:37:35.819885052Z [inf]    success: true,
2025-10-23T02:37:35.819885787Z [inf]    ]
2025-10-23T02:37:35.819890991Z [inf]    dataSaved: true,
2025-10-23T02:37:35.819891328Z [inf]  }
2025-10-23T02:37:35.819897228Z [inf]    analysisCompleted: true,
2025-10-23T02:37:35.819901562Z [inf]    employeesCreated: 0,
2025-10-23T02:37:35.819905821Z [inf]    hasAnalysisResult: true,
2025-10-23T02:37:35.819910070Z [inf]    analysisResultKeys: [
2025-10-23T02:37:35.820884855Z [inf]    hasAuth: true,
2025-10-23T02:37:35.820891618Z [inf]    contentType: 'application/json'
2025-10-23T02:37:35.820896218Z [inf]  }