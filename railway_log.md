2025-10-23T17:49:51.000000000Z [inf]  Starting Container
2025-10-23T17:49:52.885155927Z [inf]  🔄 Deployment Version: 66e1fc8
2025-10-23T17:49:52.885186978Z [inf]  🤖 AI Providers: OpenAI, Anthropic, Google, Mistral
2025-10-23T17:49:52.885206000Z [inf]  
2025-10-23T17:49:52.885211147Z [inf]  ⚙️  Environment variables ready (injected by platform)
2025-10-23T17:49:52.885215838Z [inf]  ✅ Configuration validated successfully
2025-10-23T17:49:52.885222030Z [inf]  📍 Environment: production
2025-10-23T17:49:52.885235596Z [inf]  📚 Loading database module...
2025-10-23T17:49:52.885249020Z [inf]  🔌 Port: 8080
2025-10-23T17:49:52.885259424Z [inf]  ========================================
2025-10-23T17:49:52.885263712Z [inf]  🗄️  Database: Connected
2025-10-23T17:49:52.885724831Z [inf]  ========================================
2025-10-23T17:49:52.885730945Z [inf]  🚀 Mizan Server Process Starting...
2025-10-23T17:49:52.885736239Z [inf]  📅 Timestamp: 2025-10-23T17:49:51.997Z
2025-10-23T17:49:52.885742109Z [inf]  🌍 Node Version: v20.19.5
2025-10-23T17:49:52.885752465Z [inf]  📦 Environment: production
2025-10-23T17:49:53.872574268Z [inf]  ✅ Database module loaded
2025-10-23T17:49:53.872582932Z [inf]  💡 Configured Port: 8080
2025-10-23T17:49:53.872592771Z [inf]  💡 Configured Host: 0.0.0.0
2025-10-23T17:49:53.872602534Z [inf]  🌐 CORS configured with dynamic origin checking
2025-10-23T17:49:53.872609351Z [inf]  ✅ Allowed origins (static): [
2025-10-23T17:49:53.872615506Z [inf]    'http://localhost:3000',
2025-10-23T17:49:53.872621146Z [inf]    'http://localhost:3001',
2025-10-23T17:49:53.872626866Z [inf]    'https://mizan.work',
2025-10-23T17:49:53.872633136Z [inf]    'https://www.mizan.work',
2025-10-23T17:49:53.872642924Z [inf]    'https://api.mizan.work',
2025-10-23T17:49:53.872648255Z [inf]    'https://mizan-platform-final.vercel.app',
2025-10-23T17:49:53.872655092Z [inf]    'https://mizan-frontend-ten.vercel.app',
2025-10-23T17:49:53.872661789Z [inf]    'https://mizan-api.railway.app'
2025-10-23T17:49:53.872662689Z [inf]  🔌 Port: 8080
2025-10-23T17:49:53.872668151Z [inf]  ]
2025-10-23T17:49:53.872675882Z [inf]  ✅ Dynamic patterns: *.vercel.app, *.railway.app
2025-10-23T17:49:53.872676596Z [inf]  🖥️  Host: 0.0.0.0
2025-10-23T17:49:53.872687236Z [inf]  🔧 CLIENT_URL environment variable: https://mizan.work
2025-10-23T17:49:53.872687911Z [inf]  
2025-10-23T17:49:53.872695935Z [inf]  🔐 Security Configuration:
2025-10-23T17:49:53.872697602Z [inf]  🔧 FRONTEND_URL environment variable: https://mizan.work
2025-10-23T17:49:53.872705050Z [inf]    ✅ DATABASE_URL is configured
2025-10-23T17:49:53.872706476Z [inf]  🎬 Invoking startServer() function...
2025-10-23T17:49:53.872712205Z [inf]  
2025-10-23T17:49:53.872715331Z [inf]    ✅ JWT/SESSION_SECRET is configured
2025-10-23T17:49:53.872721024Z [inf]  
2025-10-23T17:49:53.872726620Z [inf]  🌐 Starting HTTP server...
2025-10-23T17:49:53.872733707Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T17:49:53.872733921Z [inf]     Binding to: 0.0.0.0:8080
2025-10-23T17:49:53.872742645Z [inf]  🔍 Database connection attempt 1/2...
2025-10-23T17:49:53.872743071Z [inf]  🚀 STARTING MIZAN PLATFORM SERVER v2.0.0
2025-10-23T17:49:53.872750806Z [inf]  🔍 Testing database connection...
2025-10-23T17:49:53.872752786Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T17:49:53.872759283Z [inf]  
2025-10-23T17:49:53.872761245Z [inf]  📍 Environment: production
2025-10-23T17:49:53.872766168Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T17:49:53.872771894Z [inf]  ✅ MIZAN PLATFORM SERVER ONLINE
2025-10-23T17:49:53.872778018Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T17:49:53.872784571Z [inf]  🌐 Server: http://0.0.0.0:8080
2025-10-23T17:49:53.872790583Z [inf]  🏥 Health: http://0.0.0.0:8080/health
2025-10-23T17:49:53.872796840Z [inf]  📊 Features: Three-Engine AI, Multi-Provider Consensus
2025-10-23T17:49:53.872802412Z [inf]  🔒 Security: CORS, Helmet, Rate Limiting
2025-10-23T17:49:53.872809069Z [inf]  🗄️  Database: Testing connection in background...
2025-10-23T17:49:53.872815107Z [inf]  ═══════════════════════════════════════════════════════════
2025-10-23T17:49:53.872822320Z [inf]  
2025-10-23T17:49:53.872827649Z [inf]  ✅ startServer() invocation completed successfully
2025-10-23T17:49:53.883246892Z [inf]  ✅ Database connection established
2025-10-23T17:49:53.883251626Z [inf]  ✅ Database connection established
2025-10-23T17:49:53.883258615Z [inf]  ✅ Database connection successful
2025-10-23T17:49:53.883266252Z [inf]  ✅ Database fully connected and operational
2025-10-23T17:49:53.883270785Z [inf]  ✅ Database connection validated successfully
2025-10-23T17:49:55.142197889Z [inf]  🏥 Health check requested. Reporting current status:
2025-10-23T17:49:55.142326053Z [inf]    - Server Status: running
2025-10-23T17:49:55.142338985Z [inf]    - Database Status: connected
2025-10-23T17:49:55.142346459Z [inf]    - DATABASE_URL: Set (hidden)
2025-10-23T17:50:25.786316402Z [inf]  📥 [Request] {
2025-10-23T17:50:25.786322383Z [inf]    method: 'GET',
2025-10-23T17:50:25.786328606Z [inf]    path: '/api/superadmin/stats',
2025-10-23T17:50:25.786335949Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.786346144Z [inf]    hasAuth: true,
2025-10-23T17:50:25.786352234Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.786357959Z [inf]  }
2025-10-23T17:50:25.786364396Z [inf]  📥 [Request] {
2025-10-23T17:50:25.786371225Z [inf]    method: 'GET',
2025-10-23T17:50:25.786377062Z [inf]    path: '/api/superadmin/activity',
2025-10-23T17:50:25.786383182Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.786389601Z [inf]    hasAuth: true,
2025-10-23T17:50:25.786507964Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.786514721Z [inf]  }
2025-10-23T17:50:25.786530487Z [inf]  📥 [Request] {
2025-10-23T17:50:25.786537642Z [inf]    method: 'GET',
2025-10-23T17:50:25.786544180Z [inf]    path: '/api/superadmin/revenue',
2025-10-23T17:50:25.786551070Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.786558164Z [inf]    hasAuth: true,
2025-10-23T17:50:25.786566977Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.786573522Z [inf]  }
2025-10-23T17:50:25.786579852Z [inf]  📥 [Request] {
2025-10-23T17:50:25.786585884Z [inf]    method: 'GET',
2025-10-23T17:50:25.786591371Z [inf]    path: '/api/superadmin/tenants',
2025-10-23T17:50:25.786597745Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.786606669Z [inf]    hasAuth: true,
2025-10-23T17:50:25.786613350Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.786623588Z [inf]  }
2025-10-23T17:50:25.786631587Z [inf]  Fetching superadmin stats for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T17:50:25.786644566Z [inf]  Fetching activity data for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T17:50:25.791203933Z [inf]  Database connection verified
2025-10-23T17:50:25.791208257Z [inf]  Database connection verified for activity
2025-10-23T17:50:25.791212760Z [inf]  Fetched tenants: 3
2025-10-23T17:50:25.791217416Z [inf]  Fetched recent tenants: 3
2025-10-23T17:50:25.791221387Z [inf]  Fetched users: 23
2025-10-23T17:50:25.791225527Z [inf]  Stats calculated successfully: {
2025-10-23T17:50:25.791230442Z [inf]    totalTenants: 3,
2025-10-23T17:50:25.791234947Z [inf]    totalUsers: 23,
2025-10-23T17:50:25.791239685Z [inf]    activeTenants: 3,
2025-10-23T17:50:25.791244393Z [inf]    totalRevenue: 1220,
2025-10-23T17:50:25.791249183Z [inf]    monthlyGrowth: 8.7,
2025-10-23T17:50:25.791253258Z [inf]    totalAnalyses: 6
2025-10-23T17:50:25.791257706Z [inf]  }
2025-10-23T17:50:25.791262486Z [inf]  Fetched recent users: 5
2025-10-23T17:50:25.791267722Z [inf]  Activity: Tenant test ID: 99c97d43-d075-4ebe-b719-24511cd287d6 -> 580118854
2025-10-23T17:50:25.791272000Z [inf]  Activity: Tenant TEst ID: 1ce32fe3-6788-44e9-82c5-fb799a0501ab -> 484650980
2025-10-23T17:50:25.791276188Z [inf]  Activity: Tenant Mizan Superadmin ID: superadmin-tenant -> 1
2025-10-23T17:50:25.791280606Z [inf]  Activity: User chris@company.com TenantID: 1ce32fe3-6788-44e9-82c5-fb799a0501ab -> 484650980
2025-10-23T17:50:25.791285758Z [inf]  Activity: User lisa@company.com TenantID: 1ce32fe3-6788-44e9-82c5-fb799a0501ab -> 484650980
2025-10-23T17:50:25.791290196Z [inf]  Activity: User james@company.com TenantID: 1ce32fe3-6788-44e9-82c5-fb799a0501ab -> 484650980
2025-10-23T17:50:25.791294262Z [inf]  Activity: User amanda@company.com TenantID: 1ce32fe3-6788-44e9-82c5-fb799a0501ab -> 484650980
2025-10-23T17:50:25.791298184Z [inf]  Activity: User robert@company.com TenantID: 1ce32fe3-6788-44e9-82c5-fb799a0501ab -> 484650980
2025-10-23T17:50:25.791301966Z [inf]  ✅ Database connection established
2025-10-23T17:50:25.791306024Z [inf]  ✅ Database connection established
2025-10-23T17:50:25.796641967Z [inf]  Database connection verified for tenants
2025-10-23T17:50:25.796660153Z [inf]  Database connection verified for revenue
2025-10-23T17:50:25.796668213Z [inf]  Fetched all tenants: 3
2025-10-23T17:50:25.796674974Z [inf]  Fetched tenants: 3
2025-10-23T17:50:25.796681733Z [inf]  ✅ Converted tenant ID: "superadmin-tenant" -> 1 (type: number)
2025-10-23T17:50:25.796688845Z [inf]  ✅ Converted tenant ID: "99c97d43-d075-4ebe-b719-24511cd287d6" -> 580118854 (type: number)
2025-10-23T17:50:25.796695428Z [inf]  ✅ Converted tenant ID: "1ce32fe3-6788-44e9-82c5-fb799a0501ab" -> 484650980 (type: number)
2025-10-23T17:50:25.796703245Z [inf]  📥 [Request] {
2025-10-23T17:50:25.796711618Z [inf]  Fetching tenants for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T17:50:25.796713007Z [inf]    method: 'GET',
2025-10-23T17:50:25.796719069Z [inf]  Fetching revenue data for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T17:50:25.796721720Z [inf]    path: '/api/superadmin/tenants',
2025-10-23T17:50:25.796738841Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.796750897Z [inf]    hasAuth: true,
2025-10-23T17:50:25.796759780Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.796766728Z [inf]  }
2025-10-23T17:50:25.796774781Z [inf]  Fetching tenants for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T17:50:25.796783503Z [inf]  Database connection verified for tenants
2025-10-23T17:50:25.796791346Z [inf]  Fetched tenants: 3
2025-10-23T17:50:25.796798760Z [inf]  ✅ Converted tenant ID: "superadmin-tenant" -> 1 (type: number)
2025-10-23T17:50:25.796805326Z [inf]  ✅ Converted tenant ID: "1ce32fe3-6788-44e9-82c5-fb799a0501ab" -> 484650980 (type: number)
2025-10-23T17:50:25.796814242Z [inf]  ✅ Converted tenant ID: "99c97d43-d075-4ebe-b719-24511cd287d6" -> 580118854 (type: number)
2025-10-23T17:50:25.796821491Z [inf]  📥 [Request] {
2025-10-23T17:50:25.803303215Z [inf]    userId: 'a8b36994-723d-45b8-a5bc-d7eea4f2bc18',
2025-10-23T17:50:25.803316782Z [inf]    count: 3,
2025-10-23T17:50:25.803324594Z [inf]    filters: { status: undefined },
2025-10-23T17:50:25.803332834Z [inf]    pagination: { limit: 100, offset: 0 }
2025-10-23T17:50:25.803340196Z [inf]  }
2025-10-23T17:50:25.803401090Z [inf]    method: 'GET',
2025-10-23T17:50:25.803407747Z [inf]    path: '/api/demo/requests',
2025-10-23T17:50:25.803415976Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.803423819Z [inf]    hasAuth: true,
2025-10-23T17:50:25.803433919Z [inf]    contentType: 'none'
2025-10-23T17:50:25.803441405Z [inf]  }
2025-10-23T17:50:25.803448820Z [inf]  Demo requests accessed by superadmin: {
2025-10-23T17:50:25.804307434Z [inf]  📥 [Request] {
2025-10-23T17:50:25.804316635Z [inf]    method: 'GET',
2025-10-23T17:50:25.804322624Z [inf]    path: '/api/superadmin/analytics/agents',
2025-10-23T17:50:25.804329166Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.804335598Z [inf]    hasAuth: true,
2025-10-23T17:50:25.804341698Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.804349241Z [inf]  }
2025-10-23T17:50:25.804356777Z [inf]  📥 [Request] {
2025-10-23T17:50:25.804363743Z [inf]    method: 'GET',
2025-10-23T17:50:25.804370292Z [inf]    path: '/api/superadmin/analytics/api',
2025-10-23T17:50:25.804378515Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.804384487Z [inf]    hasAuth: true,
2025-10-23T17:50:25.804390439Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.804397311Z [inf]  }
2025-10-23T17:50:25.804404684Z [inf]  📥 [Request] {
2025-10-23T17:50:25.804410451Z [inf]    method: 'GET',
2025-10-23T17:50:25.804415979Z [inf]    path: '/api/superadmin/analytics/performance',
2025-10-23T17:50:25.804421634Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.812728024Z [inf]    method: 'GET',
2025-10-23T17:50:25.812736875Z [inf]  Fetched tenants: 3
2025-10-23T17:50:25.812741548Z [inf]    path: '/api/superadmin/analytics/usage',
2025-10-23T17:50:25.812748505Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.812753837Z [inf]  ✅ Converted tenant ID: "superadmin-tenant" -> 1 (type: number)
2025-10-23T17:50:25.812756767Z [inf]    hasAuth: true,
2025-10-23T17:50:25.812763393Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.812772416Z [inf]  }
2025-10-23T17:50:25.812772618Z [inf]  ✅ Converted tenant ID: "1ce32fe3-6788-44e9-82c5-fb799a0501ab" -> 484650980 (type: number)
2025-10-23T17:50:25.812781914Z [inf]  ✅ Converted tenant ID: "99c97d43-d075-4ebe-b719-24511cd287d6" -> 580118854 (type: number)
2025-10-23T17:50:25.812782331Z [inf]  📥 [Request] {
2025-10-23T17:50:25.812791900Z [inf]    method: 'GET',
2025-10-23T17:50:25.812793647Z [inf]    hasAuth: true,
2025-10-23T17:50:25.812799234Z [inf]    path: '/api/superadmin/tenants',
2025-10-23T17:50:25.812804594Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.812807977Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:25.812813828Z [inf]  }
2025-10-23T17:50:25.812816057Z [inf]    hasAuth: true,
2025-10-23T17:50:25.812822691Z [inf]  📥 [Request] {
2025-10-23T17:50:25.812824901Z [inf]    contentType: 'application/json'
2025-10-23T17:50:25.812830927Z [inf]  }
2025-10-23T17:50:25.812838967Z [inf]  Fetching tenants for user: a8b36994-723d-45b8-a5bc-d7eea4f2bc18
2025-10-23T17:50:25.812844203Z [inf]  Database connection verified for tenants
2025-10-23T17:50:34.819319700Z [inf]    contentType: 'multipart/form-data; boundary=----WebKitFormBoundary7oPguGZxaKzAngcM'
2025-10-23T17:50:34.819343031Z [inf]  }
2025-10-23T17:50:34.819397214Z [inf]  📥 [Request] {
2025-10-23T17:50:34.819413731Z [inf]    method: 'POST',
2025-10-23T17:50:34.819426038Z [inf]    path: '/api/upload/org-chart',
2025-10-23T17:50:34.819437783Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:50:34.819447658Z [inf]    hasAuth: true,
2025-10-23T17:50:34.948705175Z [inf]  ✅ Organization structure saved successfully
2025-10-23T17:50:34.948712129Z [inf]  📊 Data quality: 12 employees, 3 levels, 5 departments
2025-10-23T17:50:55.416177620Z [inf]  📤 Database connection removed from pool
2025-10-23T17:50:55.416184169Z [err]  Provider gemini confidence too low: 0.5999999999999999 {
2025-10-23T17:50:55.416189242Z [err]    threshold: 0.7,
2025-10-23T17:50:55.416209851Z [err]    agent: 'structure',
2025-10-23T17:50:55.416216498Z [err]    agent_specific_threshold: false,
2025-10-23T17:50:55.416223497Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T17:50:55.416229699Z [err]    prompt_length: 5738,
2025-10-23T17:50:55.416235711Z [err]    response_length: 3250,
2025-10-23T17:50:55.416242268Z [err]    timestamp: '2025-10-23T17:50:51.825Z',
2025-10-23T17:50:55.416249129Z [err]    engine: 'knowledge'
2025-10-23T17:50:55.416256789Z [err]  }
2025-10-23T17:50:55.416263868Z [inf]  📤 Database connection removed from pool
2025-10-23T17:50:55.416270938Z [inf]  📤 Database connection removed from pool
2025-10-23T17:51:15.157480524Z [inf]  📤 Database connection removed from pool
2025-10-23T17:51:15.157489180Z [inf]  🔧 Attempting JSON repair for malformed response...
2025-10-23T17:51:15.157495295Z [inf]  ❌ Error at position 6842, context: ucratic friction","Slow execution"]      }    ]  }
2025-10-23T17:51:15.157503010Z [err]  ⚠️  Initial JSON parse failed, attempting repair...
2025-10-23T17:51:15.157508995Z [err]  ❌ Failed to parse knowledge output after repair: {
2025-10-23T17:51:15.157515513Z [err]    error: "Expected ',' or '}' after property value in JSON at position 6842",
2025-10-23T17:51:15.157521525Z [err]    rawResponsePreview: '```json\n' +
2025-10-23T17:51:15.157529657Z [err]      '{\n' +
2025-10-23T17:51:15.157535592Z [err]      `  "analysis": "For a comprehensive organizational structure analysis, the most critical frameworks depend on the strategic context. Without specific company data, I'll provide a prioritized framework application guide that adapts to different strategic scenarios.",\n` +
2025-10-23T17:51:15.157542389Z [err]      '  "confidence": 0.88,\n' +
2025-10-23T17:51:15.157550350Z [err]      '  "applicable_frameworks": {\n' +
2025-10-23T17:51:15.157556570Z [err]      '    "primary_diagnostic_sequence": [\n' +
2025-10-23T17:51:15.157580924Z [err]      '      {\n' +
2025-10-23T17:51:15.157588245Z [err]      `        "framework": "Chandler's Principle",\n` +
2025-10-23T17:51:15.157594693Z [err]      '        "priority": 1,\n' +
2025-10-23T17:51:15.157600410Z [err]      '        "application": "START HERE: Identify current strateg',
2025-10-23T17:51:15.157606871Z [err]    cleanedResponsePreview: `{  "analysis":"For a comprehensive organizational structure analysis,the most critical frameworks depend on the strategic context. Without specific company data,I'll provide a prioritized framework application guide that adapts to different strategic scenarios.","confidence":0.88,"applicable_frameworks":{    "primary_diagnostic_sequence":[      {        "framework":"Chandler's Principle","priority":1,"application":"START HERE:Identify current strategy type (growth,efficiency,innovation,diversifi`
2025-10-23T17:51:16.164846387Z [err]  }
2025-10-23T17:51:16.164851920Z [inf]  ✅ Database connection established
2025-10-23T17:51:16.164856972Z [inf]  📊 Fetching organization structure for tenant: 484650980
2025-10-23T17:51:16.164861249Z [inf]  ✅ Database connection established
2025-10-23T17:51:16.164865716Z [inf]  ✅ Organization structure found for tenant: 484650980
2025-10-23T17:51:16.164870012Z [inf]  📊 Data Quality Check: {
2025-10-23T17:51:16.164876454Z [inf]    hasDepartments: true,
2025-10-23T17:51:16.164880928Z [inf]    departmentCount: 5,
2025-10-23T17:51:16.164885105Z [inf]    hasReportingLines: true,
2025-10-23T17:51:16.164889258Z [inf]    reportingLineCount: 11,
2025-10-23T17:51:16.164893602Z [inf]    hasRoles: true,
2025-10-23T17:51:16.164897692Z [inf]    roleCount: 12,
2025-10-23T17:51:16.164902499Z [inf]    totalEmployees: 12,
2025-10-23T17:51:16.164908374Z [inf]    organizationLevels: 3
2025-10-23T17:51:16.164914815Z [inf]  }
2025-10-23T17:51:46.201578263Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T17:51:46.201587528Z [err]    prompt_length: 1739,
2025-10-23T17:51:46.201596735Z [err]  Provider gemini confidence too low: 0.5999999999999999 {
2025-10-23T17:51:46.201604466Z [err]    agent: 'structure',
2025-10-23T17:51:46.201606063Z [err]    threshold: 0.7,
2025-10-23T17:51:46.201615305Z [err]    agent_specific_threshold: false,
2025-10-23T17:51:46.201628023Z [err]    timestamp: '2025-10-23T17:51:38.475Z',
2025-10-23T17:51:46.201628663Z [err]    agent_specific_threshold: false,
2025-10-23T17:51:46.201630069Z [err]  }
2025-10-23T17:51:46.201636137Z [err]    engine: 'data'
2025-10-23T17:51:46.201638912Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T17:51:46.201639182Z [inf]  📤 Database connection removed from pool
2025-10-23T17:51:46.201645999Z [err]    threshold: 0.7,
2025-10-23T17:51:46.201647045Z [err]    response_length: 3312,
2025-10-23T17:51:46.201649098Z [err]    prompt_length: 1739,
2025-10-23T17:51:46.201650161Z [err]  Provider mistral confidence too low: 0.5999999999999999 {
2025-10-23T17:51:46.201655017Z [err]    agent: 'structure',
2025-10-23T17:51:46.201681887Z [err]  }
2025-10-23T17:51:46.201687478Z [err]    response_length: 9926,
2025-10-23T17:51:46.201703478Z [err]    timestamp: '2025-10-23T17:51:45.107Z',
2025-10-23T17:51:46.201710896Z [err]    engine: 'data'
2025-10-23T17:51:55.065022660Z [err]  Provider openai confidence too low: 0.5999999999999999 {
2025-10-23T17:51:55.065029539Z [err]    threshold: 0.7,
2025-10-23T17:51:55.065036008Z [err]    agent: 'structure',
2025-10-23T17:51:55.065042256Z [err]    agent_specific_threshold: false,
2025-10-23T17:51:55.065049913Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T17:51:55.065056102Z [err]    prompt_length: 6602,
2025-10-23T17:51:55.065064283Z [err]    response_length: 2035,
2025-10-23T17:51:55.065071382Z [err]    timestamp: '2025-10-23T17:51:54.635Z',
2025-10-23T17:51:55.065080280Z [err]    engine: 'reasoning'
2025-10-23T17:51:55.065087620Z [err]  }
2025-10-23T17:52:26.036438869Z [err]  Gemini invocation failed: Error: Gemini returned empty content
2025-10-23T17:52:26.036444102Z [err]      at AIProviderRouter.invokeGemini (/app/dist/src/services/ai-providers/router.js:181:23)
2025-10-23T17:52:26.036448788Z [err]      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
2025-10-23T17:52:26.036452717Z [err]      at async EnsembleAI.callProviderSafely (/app/dist/src/services/ai-providers/ensemble.js:57:30)
2025-10-23T17:52:26.036456505Z [err]      at async Promise.all (index 2)
2025-10-23T17:52:26.036470625Z [err]      at async EnsembleAI.call (/app/dist/src/services/ai-providers/ensemble.js:26:27)
2025-10-23T17:52:26.036475233Z [err]      at async StructureAgent.runReasoningEngine (/app/dist/src/services/agents/base/three-engine-agent.js:104:26)
2025-10-23T17:52:26.036480265Z [err]      at async StructureAgent.analyze (/app/dist/src/services/agents/base/three-engine-agent.js:35:37)
2025-10-23T17:52:26.036484198Z [err]      at async StructureAgent.analyzeOrganizationStructure (/app/dist/src/services/agents/structure-agent.js:41:24)
2025-10-23T17:52:26.036490065Z [err]      at async handleOrgChartUpload (/app/dist/src/routes/upload.js:396:30)
2025-10-23T17:52:26.036493958Z [err]  Provider gemini failed: Error: Gemini returned empty content
2025-10-23T17:52:26.036497735Z [err]      at AIProviderRouter.invokeGemini (/app/dist/src/services/ai-providers/router.js:181:23)
2025-10-23T17:52:26.036503147Z [err]      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
2025-10-23T17:52:26.036507845Z [err]      at async EnsembleAI.callProviderSafely (/app/dist/src/services/ai-providers/ensemble.js:57:30)
2025-10-23T17:52:26.036511828Z [err]      at async Promise.all (index 2)
2025-10-23T17:52:26.036515574Z [err]      at async EnsembleAI.call (/app/dist/src/services/ai-providers/ensemble.js:26:27)
2025-10-23T17:52:26.036519183Z [err]      at async StructureAgent.runReasoningEngine (/app/dist/src/services/agents/base/three-engine-agent.js:104:26)
2025-10-23T17:52:26.041602644Z [err]      at async StructureAgent.analyze (/app/dist/src/services/agents/base/three-engine-agent.js:35:37)
2025-10-23T17:52:26.041609159Z [err]      at async StructureAgent.analyzeOrganizationStructure (/app/dist/src/services/agents/structure-agent.js:41:24)
2025-10-23T17:52:26.041615096Z [err]      at async handleOrgChartUpload (/app/dist/src/routes/upload.js:396:30)
2025-10-23T17:53:07.144884177Z [err]    response_length: 16536,
2025-10-23T17:53:07.144894090Z [err]    timestamp: '2025-10-23T17:52:59.988Z',
2025-10-23T17:53:07.144903506Z [err]    engine: 'reasoning'
2025-10-23T17:53:07.144910640Z [inf]  🔧 Attempting JSON repair for malformed response...
2025-10-23T17:53:07.144914183Z [err]  }
2025-10-23T17:53:07.144921987Z [err]  ⚠️  Initial JSON parse failed, attempting repair...
2025-10-23T17:53:07.144922087Z [err]      '{\n' +
2025-10-23T17:53:07.144925648Z [inf]  ❌ Error at position 13990, context: utput":"Action plan with timelines and RACI."    }
2025-10-23T17:53:07.144932493Z [err]  Provider anthropic confidence too low: 0.5999999999999999 {
2025-10-23T17:53:07.144936434Z [err]  ❌ Failed to parse reasoning output after repair: {
2025-10-23T17:53:07.144940943Z [err]      '  "organizational_assessment": {\n' +
2025-10-23T17:53:07.144944013Z [err]    threshold: 0.7,
2025-10-23T17:53:07.144948785Z [err]    error: "Expected ',' or '}' after property value in JSON at position 13990",
2025-10-23T17:53:07.144953755Z [err]      '    "overall_score": {\n' +
2025-10-23T17:53:07.144954641Z [err]    agent: 'structure',
2025-10-23T17:53:07.144958487Z [err]    rawResponsePreview: '```json\n' +
2025-10-23T17:53:07.144963197Z [err]    agent_specific_threshold: false,
2025-10-23T17:53:07.144970050Z [err]    actual_confidence: 0.5999999999999999,
2025-10-23T17:53:07.144975975Z [err]    prompt_length: 6602,
2025-10-23T17:53:07.145221357Z [err]      '      "score": 5,\n' +
2025-10-23T17:53:07.145231567Z [err]      '      "reasoning": {\n' +
2025-10-23T17:53:07.145239854Z [err]      '        "primary_factors": [\n' +
2025-10-23T17:53:07.145248581Z [err]      '          {\n' +
2025-10-23T17:53:07.145261969Z [err]      '            "factor": "data_completeness_crisis",\n' +
2025-10-23T17:53:07.145268802Z [err]      '            "weight": 0.7,\n' +
2025-10-23T17:53:08.077551130Z [inf]    path: '/api/analyses/structure',
2025-10-23T17:53:08.077552566Z [err]      '            "explanation": "Critical deficiency in structural data (completeness_score: 0.15) prevents meaningful assessment. The 3-layer skeleton (potentially healthy) is offset by zero span metrics and missing role/employee data.",\n' +
2025-10-23T17:53:08.077559970Z [err]      '            "theory_link": "Galbraith’s Sta',
2025-10-23T17:53:08.077564452Z [inf]    origin: 'https://www.mizan.work',
2025-10-23T17:53:08.077573352Z [inf]  }
2025-10-23T17:53:08.077573910Z [inf]    hasAuth: true,
2025-10-23T17:53:08.077585905Z [err]    cleanedResponsePreview: '{  "organizational_assessment":{    "overall_score":{      "score":5,"reasoning":{        "primary_factors":[          {            "factor":"data_completeness_crisis","weight":0.7,"explanation":"Critical deficiency in structural data (completeness_score:0.15) prevents meaningful assessment. The 3-layer skeleton (potentially healthy) is offset by zero span metrics and missing role/employee data.","theory_link":"Galbraith’s Star Model requires *all* design policies (including structure) to be def'
2025-10-23T17:53:08.077587027Z [inf]    contentType: 'application/json'
2025-10-23T17:53:08.077594067Z [err]  }
2025-10-23T17:53:08.077600661Z [inf]  ✅ Structure analysis completed successfully
2025-10-23T17:53:08.077610080Z [inf]  ✅ Database connection established
2025-10-23T17:53:08.077618454Z [inf]  📊 Sending response to frontend: {
2025-10-23T17:53:08.077618669Z [inf]    ]
2025-10-23T17:53:08.077626078Z [inf]    id: 'e1f0e2fe-0944-4219-a9a2-b66be00e1b7a',
2025-10-23T17:53:08.077629344Z [inf]  }
2025-10-23T17:53:08.077633993Z [inf]    success: true,
2025-10-23T17:53:08.077637776Z [inf]  📥 [Request] {
2025-10-23T17:53:08.077642031Z [inf]    dataSaved: true,
2025-10-23T17:53:08.077647986Z [inf]    method: 'POST',
2025-10-23T17:53:08.077651409Z [inf]    analysisCompleted: true,
2025-10-23T17:53:08.077658031Z [inf]    employeesCreated: 0,
2025-10-23T17:53:08.077664695Z [inf]    hasAnalysisResult: true,
2025-10-23T17:53:08.077671025Z [inf]    analysisResultKeys: [
2025-10-23T17:53:08.077676828Z [inf]      'overall_score',
2025-10-23T17:53:08.077683033Z [inf]      'span_analysis',
2025-10-23T17:53:08.077693582Z [inf]      'layer_analysis',
2025-10-23T17:53:08.077700568Z [inf]      'strategy_alignment',
2025-10-23T17:53:08.077707136Z [inf]      'recommendations'
2025-10-23T17:53:37.728043720Z [inf]  📤 Database connection removed from pool